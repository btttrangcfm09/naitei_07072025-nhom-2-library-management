<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layouts/admin_layout}">

<head>
    <title th:text="#{admin.bookinstances.page_title}"></title>
    <link rel="stylesheet" th:href="@{/css/bookinstance-list.css}">
</head>

<body>
    <div layout:fragment="content">
        <div class="page-header d-flex justify-content-between align-items-center">
            <div>
                <h3 class="page-title">
                    <span class="page-title-icon bg-gradient-primary text-white mr-2">
                        <i class="mdi mdi-book-open-page-variant"></i>
                    </span>
                    <span th:text="#{admin.bookinstances.header_title}"></span>
                </h3>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a th:href="@{/admin/dashboard}"
                                th:text="#{admin.breadcrumb.dashboard}"></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page" th:text="#{admin.breadcrumb.all_books}">
                        </li>
                    </ol>
                </nav>
            </div>
            <!--Liên quan việc import dữ liệu từ file excel-->
            <div>
                <div class="d-flex align-items-center">
                    <!--Nút up file excel-->
                    <form th:action="@{/admin/bookinstances/import}" method="post" enctype="multipart/form-data"
                        id="importForm" class="import-form">
                        <input type="file" name="file" id="fileInput" accept=".xlsx,.xls" class="input-file"
                            onchange="document.getElementById('importForm').submit();">
                        <button type="button" class="btn btn-primary btn-icon-text"
                            onclick="document.getElementById('fileInput').click();">
                            <i class="mdi mdi-plus-circle mr-2"></i>
                            <span th:text="#{admin.bookinstances.excel_import}"></span>
                        </button>
                    </form>
                    <!-- Link tải file mẫu-->
                    <a th:href="@{../../excel-templates/mau-import-sach.xlsx}" download="mau-import-sach.xlsx"
                        class="btn btn-outline-success btn-icon-text ms-2">
                        <i class="mdi mdi-download mr-2"></i>
                        <span th:text="#{admin.bookinstances.excel_example}"></span>
                    </a>
                </div>
                <!--Hiện thị box thông báo lỗi-->
                <div th:if="${errorMessage}" class="alert alert-danger d-flex align-items-start mt-3 success-error" role="alert">
                    <i class="mdi mdi-alert-circle-outline me-2 box-message"></i>
                    <div>
                        <p class="fw-bold mb-1" th:text="${errorMessage}"></p>
                        <ul th:if="${validationErrors}" class="mb-0 ps-3">
                            <li th:each="err : ${validationErrors}" th:text="${err}"></li>
                        </ul>
                    </div>
                </div>
                <!-- Hiện thị thông báo thành công-->
                <div th:if="${successMessage}" class="alert alert-success d-flex align-items-center mt-3" role="alert">
                    <i class="mdi mdi-check-circle-outline me-2 box-message"></i>
                    <div th:text="${successMessage}"></div>
                </div>
            </div>
        </div>

        <!-- Filter và Search -->
        <div class="row">
            <div class="col-12 grid-margin">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title" th:text="#{admin.bookinstances.search.card_title}"></h4>
                        <form th:action="@{/admin/bookinstances}" method="get" class="d-flex align-items-end flex-wrap">
                            <div class="form-group mr-3 flex-grow-1">
                                <input type="text" class="form-control" id="keyword" name="keyword"
                                    placeholder="Nhập ISBN, Barcode hoặc Call Number..." th:value="${keyword}">
                            </div>
                            <div class="form-group mr-3">
                                <input type="date" class="form-control" id="fromDate" name="fromDate"
                                    th:value="${fromDate}" th:title="#{admin.bookinstances.search.fromDate}">
                            </div>
                            <div class="form-group mr-3">
                                <input type="date" class="form-control" id="toDate" name="toDate" th:value="${toDate}"
                                    th:title="#{admin.bookinstances.search.toDate}">
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn btn-gradient-primary mr-2">
                                    <i class="mdi mdi-magnify mr-2"></i><span
                                        th:text="#{admin.books.button.search}"></span>
                                </button>
                                <a th:href="@{/admin/bookinstances}" class="btn btn-light mr-2">
                                    <i class="mdi mdi-refresh mr-2"></i><span
                                        th:text="#{admin.books.button.reset}"></span>
                                </a>
                            </div>

                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bảng danh sách sách -->
        <div class="row">
            <div class="col-12 grid-margin">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h4 class="card-title mb-0" th:text="#{admin.bookinstances.list.card_title}"></h4>
                            <span class="text-muted" th:if="${editionPage != null and !editionPage.empty}">
                                <span th:text="#{admin.bookinstances.total.prefix}"></span>
                                <strong>[[${editionPage.totalElements}]]</strong> <span
                                    th:text="#{admin.bookinstances.total.suffix}"></span>
                            </span>
                        </div>

                        <table class="table table-hover titlestyle">
                            <thead>
                                <tr>
                                    <th th:text="#{admin.bookinstances.table.header.index}"></th>
                                    <th th:text="#{admin.bookinstances.table.header.title}"></th>
                                    <th th:text="#{admin.bookinstances.table.header.language}"></th>
                                    <th th:text="#{admin.bookinstances.table.header.isbn}"></th>
                                    <th th:text="#{admin.bookinstances.table.header.publisher}"></th>
                                    <th th:text="#{admin.bookinstances.table.header.publicationYear}"></th>
                                    <th class="text-center" th:text="#{admin.bookinstances.table.header.bookinstance}"></th>
                                    <!-- <th class="text-center" th:text="#{admin.bookinstances.table.header.actions}"></th> -->
                                </tr>
                            </thead>
                            <tbody>
                                <!-- THÔNG BÁO KHI KHÔNG CÓ DỮ LIỆU -->
                                <tr th:if="${editionPage == null or editionPage.empty}">
                                    <td colspan="7" class="text-center py-5">
                                        <i class="mdi mdi-alert-circle-outline mdi-36px text-muted"></i>
                                        <p class="text-muted mt-2" th:text="#{admin.bookinstances.message.no_result}">
                                        </p>
                                    </td>
                                </tr>

                                <tr th:each="edition, iterStat : ${editionPage.content}">
                                    <td th:text="${editionPage.number * editionPage.size + iterStat.count}"></td>
                                    <td th:text="${edition.title()}"></td>
                                    <td th:text="${edition.language()}!=null ? ${edition.language()}:''"></td>
                                    <td th:text="${edition.isbn()}!=null ? ${edition.isbn()}:''"></td>
                                    <td th:text="${edition.publisher()}!=null ? ${edition.publisher()}:''"></td>
                                    <td th:text="${edition.publicationYear()}!=null ? ${edition.publicationYear()}:''">
                                    </td>
                                    <td class="text-center">
                                        <div>
                                            <a href="#" class="btn btn-sm btn-outline-primary"
                                                th:text="#{admin.bookinstances.button.view_editions(${edition.bookinstanceCount()})}">
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>

                        </table>

                        <!--PHÂN TRANG-->
                        <nav aria-label="Page navigation" class="mt-4"
                            th:if="${editionPage != null and editionPage.totalPages > 1}">
                            <ul class="pagination justify-content-center">
                                <!-- Nút Trang trước -->
                                <li class="page-item" th:classappend="${editionPage.first ? 'disabled' : ''}">
                                    <a class="page-link"
                                        th:href="@{/admin/bookinstances(page=${editionPage.number}, size=${editionPage.size})}">
                                        <span>&laquo;</span>
                                    </a>
                                </li>
                                <!-- Các trang ở giữa -->
                                <li th:each="i : ${#numbers.sequence(0, editionPage.totalPages - 1)}"
                                    th:if="${i >= editionPage.number - 2 and i <= editionPage.number + 2}"
                                    class="page-item" th:classappend="${i == editionPage.number ? 'active' : ''}">
                                    <a class="page-link"
                                        th:href="@{/admin/bookinstances(page=${i + 1}, size=${editionPage.size})}"
                                        th:text="${i + 1}"></a>
                                </li>
                                <!-- Nút Trang sau -->
                                <li class="page-item" th:classappend="${editionPage.last ? 'disabled' : ''}">
                                    <a class="page-link"
                                        th:href="@{/admin/bookinstances(page=${editionPage.number + 2}, size=${editionPage.size})}">
                                        <span>>&raquo;</span>
                                    </a>
                                </li>
                            </ul>
                        </nav>

                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>
